---
title: Task Format Reference
description: Complete reference for AOF task file frontmatter schema and body structure.
sidebar:
  order: 5
---

AOF tasks are Markdown files with YAML frontmatter. This page documents every field in the task schema.

## Complete Example

```markdown
---
schemaVersion: 1
id: TASK-2026-02-21-001
project: _inbox
title: Implement JWT refresh token endpoint
status: in-progress
priority: high

routing:
  role: developer
  team: engineering
  agent: swe-backend
  tags: [auth, api]
  workflow: swe-sdlc

lease:
  agent: swe-backend
  acquiredAt: 2026-02-21T15:00:00Z
  expiresAt: 2026-02-21T15:30:00Z
  renewCount: 1

gate:
  current: implement
  entered: 2026-02-21T15:00:00Z

sla:
  maxInProgressMs: 7200000    # 2 hours
  onViolation: alert

dependsOn:
  - TASK-2026-02-21-000

parentId: TASK-2026-02-20-010

createdAt: 2026-02-21T14:00:00Z
updatedAt: 2026-02-21T15:30:00Z
lastTransitionAt: 2026-02-21T15:00:00Z
createdBy: swe-architect

metadata:
  estimatedHours: 4
  sprint: "2026-Q1-S3"
---

# Objective

Add POST `/auth/refresh` that accepts a refresh token and returns a new access token.

## Instructions

1. Implement token validation in `src/auth/token-validator.ts`
2. Add the endpoint in `src/routes/auth.ts`
3. Implement token rotation (invalidate old token)
4. Write 8+ tests covering success and failure cases

## Acceptance Criteria

- [ ] Validates refresh token signature
- [ ] Returns new access + refresh token pair
- [ ] Invalidates old refresh token (rotation)
- [ ] Tests: 8+ covering success + failure cases
- [ ] No regression in existing auth tests
```

---

## Frontmatter Fields

### Required Fields

| Field | Type | Description |
|-------|------|-------------|
| `schemaVersion` | `1` | Schema version. Always `1`. |
| `id` | string | Stable task identifier. Format: `TASK-YYYY-MM-DD-NNN` |
| `project` | string | Project identifier (e.g., `_inbox`, `my-project`) |
| `title` | string | Human-readable task title |
| `status` | enum | Current status (see [Status Values](#status-values)) |
| `createdAt` | ISO-8601 | Creation timestamp |
| `updatedAt` | ISO-8601 | Last modification timestamp |
| `lastTransitionAt` | ISO-8601 | Last status change timestamp |
| `createdBy` | string | Agent or system that created the task |

### Status Values

| Status | Description |
|--------|-------------|
| `backlog` | Created, not yet ready for dispatch |
| `ready` | Queued for dispatch by the scheduler |
| `in-progress` | Agent actively working (has a lease) |
| `blocked` | Waiting on external dependency |
| `review` | Work complete, in workflow gate review |
| `done` | Successfully completed (terminal) |
| `cancelled` | Abandoned (terminal) |
| `deadletter` | Failed dispatch 3 times; requires manual intervention |

### Priority Values

| Priority | Description |
|----------|-------------|
| `critical` | Immediate attention; SLA: 1 hour |
| `high` | Urgent; SLA: 4 hours |
| `normal` | Standard priority (default) |
| `low` | Non-urgent; deferred if capacity constrained |

---

### Routing (`routing`)

```yaml
routing:
  role: developer          # Target role from org chart roles mapping
  team: engineering        # Target team ID
  agent: swe-backend       # Specific agent override (bypasses routing rules)
  tags: [auth, api]        # Capability tags for routing rules
  workflow: swe-sdlc       # Workflow name from project.yaml
```

All routing fields are optional. Priority: `agent` > routing rules by `role`/`tags` > team default.

---

### Lease (`lease`)

Present when `status: in-progress`. Set by the scheduler when dispatching.

```yaml
lease:
  agent: swe-backend            # Agent holding the lease
  acquiredAt: 2026-02-21T15:00Z # ISO-8601: when lease was acquired
  expiresAt: 2026-02-21T15:30Z  # ISO-8601: when lease expires
  renewCount: 0                  # How many times the lease has been renewed
```

---

### Gate State (`gate`, `gateHistory`)

Present when the task is in a workflow with gates:

```yaml
gate:
  current: implement    # Active gate ID
  entered: 2026-02-21T10:00Z

gateHistory:
  - gateId: implement
    enteredAt: 2026-02-21T10:00Z
    completedAt: 2026-02-21T12:00Z
    actor: swe-backend
    outcome: complete

  - gateId: code-review
    enteredAt: 2026-02-21T12:05Z
    completedAt: 2026-02-21T13:00Z
    actor: swe-architect
    outcome: needs_review
    blockers:
      - "Missing error handling"
```

---

### Review Context (`reviewContext`)

Set when a task is rejected by a gate reviewer:

```yaml
reviewContext:
  rejectedAt: 2026-02-21T13:00Z
  rejectedBy: swe-architect
  rejectedFrom: code-review
  blockers:
    - "Missing error handling in auth flow"
    - "Test coverage below 80%"
```

---

### SLA (`sla`)

Per-task SLA configuration (overrides defaults):

```yaml
sla:
  maxInProgressMs: 7200000    # 2 hours max in-progress
  onViolation: alert          # "alert" | "block" | "deadletter"
```

---

### Dependencies

```yaml
dependsOn:
  - TASK-2026-02-21-000   # Must be done before this task can run
  - TASK-2026-02-20-010

parentId: TASK-2026-02-20-010  # Parent task for hierarchy
```

---

### Optional Fields

| Field | Type | Description |
|-------|------|-------------|
| `instructionsRef` | string | Path to external instructions file |
| `guidanceRef` | string | Path to guidance/conventions file |
| `requiredRunbook` | string | Required runbook path or ID |
| `contentHash` | string | SHA-256 of body content (idempotency check) |
| `metadata` | object | Arbitrary key-value metadata |
| `resource` | string | Resource identifier for serialization (only one task per resource can be in-progress) |

---

## Body Structure

The task body is Markdown. The recommended structure:

```markdown
# Objective

One-paragraph description of what this task accomplishes.

## Instructions

Actionable, ordered steps the agent should follow.

1. Step one
2. Step two

## Guidance

Conventions, patterns, constraints — context the agent should follow.

- Follow TDD
- No new dependencies without approval

## Acceptance Criteria

- [ ] Criterion one
- [ ] Criterion two

## Work Log

(Added by agent during work)

- 15:00 Started implementation
- 15:30 Core logic complete, writing tests

## Outputs

(Filled in by agent on completion)

- `src/auth/token-validator.ts`
- `tests/auth/token-validator.test.ts`
```

---

## ID Format

Task IDs follow the format: `TASK-YYYY-MM-DD-NNN`

- `TASK-2026-02-21-001` — First task on February 21, 2026
- `TASK-2026-02-21-001-02` — Sub-task variant (with optional suffix)

IDs are stable and never change after creation. File paths change as status changes (the file moves between directories), but the ID remains constant.

## File Location

Task files live under the configured `dataDir`, organized by status:

```
tasks/
├── backlog/
│   └── TASK-2026-02-21-003.md
├── ready/
│   └── TASK-2026-02-21-002.md
├── in-progress/
│   └── TASK-2026-02-21-001.md
├── review/
├── done/
├── blocked/
├── cancelled/
└── deadletter/
```
