---
title: Memory Medallion Architecture
description: How AOF organizes agent memory into hot, warm, and cold tiers for efficient context management.
sidebar:
  order: 4
---

import { Aside } from '@astrojs/starlight/components';

AOF's memory system uses a **medallion architecture** — a three-tier data organization pattern borrowed from data engineering. Each tier has different freshness, relevance, and indexing characteristics. Agents retrieve memory from the appropriate tier based on what they need.

## The Three Tiers

```
Hot (Gold) ──── Canonical, always-indexed core documentation
    │             Always fresh, small (&lt;50KB total)
    │             Read frequently, written rarely
    │
Warm (Silver) ── Team-scoped operational knowledge
    │             Updated automatically from task patterns
    │             Aggregated runbooks, decisions, status
    │
Cold (Bronze) ── Immutable historical record
                  Event logs, transcripts, incidents
                  Write-heavy, rarely read
                  Never indexed
```

### Hot Tier

The hot tier contains **canonical, always-indexed** documentation — the source of truth for stable concepts:

- Coding standards and architectural patterns
- Team conventions and decision records
- Product vision and roadmap summaries
- API reference docs

**Characteristics:**
- **Always indexed** — every agent context query includes hot tier
- **Small** — target &lt;50KB total to avoid context bloat
- **Stable** — changes infrequently; human-curated
- **Path:** `memory/hot/` (configurable via `memoryPools.hot.path`)

### Warm Tier

The warm tier contains **team-scoped operational knowledge** — living documents that are updated as work happens:

- Per-project runbooks (updated as patterns emerge)
- Decision logs (why we chose X over Y)
- Status summaries (what's in-flight)
- Per-agent working memory

**Characteristics:**
- **Role-scoped** — agents see warm pools that match their role
- **Aggregated** — content is assembled from completed task outputs
- **Fresh** — updated on each scheduler cycle
- **Path:** `memory/warm/` (configurable via `memoryPools.warm`)

### Cold Tier

The cold tier is the **immutable historical record** — everything that happened, preserved for forensics and audit:

- JSONL event logs (task transitions, dispatcher events)
- Agent session transcripts
- Incident reports and post-mortems

**Characteristics:**
- **Never indexed** — excluded from vector search to reduce noise
- **Append-only** — never modified after write
- **Timestamped** — ISO-8601 filenames for chronological ordering
- **Path:** `memory/cold/` (configurable via `memoryPools.cold`)

## Org Chart Configuration

Define memory pools in your org chart:

```yaml
# org/org-chart.yaml
memoryPools:
  hot:
    path: memory/hot
    description: "Canonical core documentation"

  warm:
    - id: engineering
      path: memory/warm/engineering
      description: "Engineering team shared context"
      roles:
        - developer
        - reviewer
        - architect

    - id: qa-pool
      path: memory/warm/qa
      description: "QA team working memory"
      roles:
        - qa

    - id: per-agent
      path: memory/warm/agents
      description: "Per-agent working memory"
      roles:
        - "*"         # All roles

  cold:
    - memory/cold/archive

  adapter: filesystem   # "filesystem" | "lancedb"
```

## HNSW Vector Search

AOF uses **HNSW (Hierarchical Navigable Small World)** indexes for vector similarity search across memory tiers. The index supports:

- **Incremental inserts** — new documents are added without rebuilding the full index
- **Disk persistence** — index survives restarts
- **Cosine similarity** — optimized for embedding-based search
- **Hybrid search** — combines vector similarity with BM25 keyword scoring

### Hybrid Search Configuration

```json
{
  "memory": {
    "search": {
      "hybridEnabled": true,
      "vectorWeight": 0.7,    // 70% vector similarity
      "bm25Weight": 0.3,      // 30% BM25 keyword
      "maxResults": 10,
      "tierBoost": {
        "hot": 1.0,           // Hot docs ranked highest
        "warm": 0.8,
        "cold": 0.5
      }
    }
  }
}
```

## Promotion Pipeline

Documents flow up the tiers automatically:

```
Agent completes task
        │
        ▼
Task output written to cold/logs/
        │
Warm aggregation job runs (scheduler)
        │
        ▼
Patterns extracted → warm/runbooks/
Decision records → warm/decisions/
        │
Curation task dispatched
        │
        ▼
Human/agent curator promotes to hot/
(when pattern is canonical and stable)
```

### Generating Memory Configuration

```bash
# Generate memory config from your org chart
aof memory generate

# Audit memory config against org chart
aof memory audit

# Generate curation tasks (for hot tier promotion)
aof memory curate
```

## Embedding Providers

Configure which embedding provider to use for vector indexing:

```json
{
  "memory": {
    "embedding": {
      "provider": "openai",
      "model": "text-embedding-3-small",
      "apiKey": "sk-...",
      "dimensions": 1536
    }
  }
}
```

| Provider | Models | Notes |
|----------|--------|-------|
| `openai` | `text-embedding-3-small`, `text-embedding-3-large` | Requires API key |
| `ollama` | Any locally-served embedding model | Requires local Ollama instance |

```json
{
  "memory": {
    "embedding": {
      "provider": "ollama",
      "model": "nomic-embed-text",
      "baseUrl": "http://localhost:11434",
      "dimensions": 768
    }
  }
}
```

## Memory Tools (Agent API)

When the memory module is enabled, agents get additional tools:

| Tool | Description |
|------|-------------|
| `aof_memory_search` | Semantic search across hot/warm tiers |
| `aof_memory_write` | Write a memory entry to a tier |
| `aof_memory_index` | Index a directory into the vector store |

See [Agent Tools Reference](/reference/agent-tools) for full parameter documentation.

## Index Paths

You can configure additional paths to index beyond the managed memory pools:

```json
{
  "memory": {
    "indexPaths": [
      "~/Projects/AOF/docs",
      "~/shared-knowledge/engineering"
    ]
  }
}
```

<Aside type="note">
The memory module is **disabled by default** (`modules.memory.enabled: false`). See [Memory Module Setup](/guides/memory-setup) for the full enablement guide.
</Aside>
